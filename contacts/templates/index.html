{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh B·∫° - Contact Book</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üì± Danh B·∫° C·ªßa T√¥i</h1>
            <p class="subtitle">Qu·∫£n l√Ω li√™n h·ªá d·ªÖ d√†ng v√† ti·ªán l·ª£i</p>
        </header>

        <!-- Search Section -->
        <div class="search-section">
            <form method="GET" action="{% url 'home' %}" class="search-bar">
                <input type="text" name="search" placeholder="üîç T√¨m ki·∫øm theo t√™n ho·∫∑c s·ªë ƒëi·ªán tho·∫°i..." value="{{ search_query }}"/>
                <button type="submit" class="btn btn-primary">T√¨m ki·∫øm</button>
            </form>
            <button class="btn btn-add" onclick="showAddModal()">‚ûï Th√™m li√™n h·ªá m·ªõi</button>
        </div>

        <!-- Contacts List -->
        <div class="contacts-section">
            <div class="section-header">
                <h2>Danh s√°ch li√™n h·ªá</h2>
                <span class="contact-count">{{ contacts|length }} li√™n h·ªá</span>
            </div>

            {% if contacts %}
            <ul class="contact-list">
                {% for contact in contacts %}
                <li class="contact-item">
                    <div class="contact-avatar">{{ contact.first_name|first|upper }}</div>
                    <div class="contact-info">
                        <div class="contact-name">{{ contact.get_full_name }}</div>
                        <div class="contact-phone">üìû {{ contact.phone_number }}</div>
                        {% if contact.email %}
                        <div class="contact-email">‚úâÔ∏è {{ contact.email }}</div>
                        {% endif %}
                    </div>
                    <div class="contact-actions">
                        <button class="action-btn btn-edit" onclick="showEditModal({{ contact.id }}, '{{ contact.first_name }}', '{{ contact.last_name }}', '{{ contact.phone_number }}', '{{ contact.email }}', '{{ contact.address }}', '{{ contact.birthday|date:'Y-m-d' }}')">S·ª≠a</button>
                        <button class="action-btn btn-delete" onclick="showDeleteModal({{ contact.id }}, '{{ contact.get_full_name }}')">X√≥a</button>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
                <h3>Ch∆∞a c√≥ li√™n h·ªá n√†o</h3>
                <p>H√£y th√™m li√™n h·ªá ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
            </div>
            {% endif %}
        </div>

        <!-- Add Contact Modal -->
        <div id="addModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeAddModal()">&times;</span>
                <h2>Th√™m li√™n h·ªá m·ªõi</h2>
                <form method="POST" action="{% url 'create_contact' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>H·ªç:</label>
                        <input type="text" name="first_name" required>
                    </div>
                    <div class="form-group">
                        <label>T√™n:</label>
                        <input type="text" name="last_name" required>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                        <input type="text" name="phone_number" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" name="email">
                    </div>
                    <div class="form-group">
                        <label>ƒê·ªãa ch·ªâ:</label>
                        <input type="text" name="address">
                    </div>
                    <div class="form-group">
                        <label>Ng√†y sinh:</label>
                        <input type="date" name="birthday">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">L∆∞u</button>
                        <button type="button" class="btn btn-secondary" onclick="closeAddModal()">H·ªßy</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Contact Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditModal()">&times;</span>
                <h2>Ch·ªânh s·ª≠a li√™n h·ªá</h2>
                <form method="POST" id="editForm">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>H·ªç:</label>
                        <input type="text" name="first_name" id="edit_first_name" required>
                    </div>
                    <div class="form-group">
                        <label>T√™n:</label>
                        <input type="text" name="last_name" id="edit_last_name" required>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                        <input type="text" name="phone_number" id="edit_phone_number" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" name="email" id="edit_email">
                    </div>
                    <div class="form-group">
                        <label>ƒê·ªãa ch·ªâ:</label>
                        <input type="text" name="address" id="edit_address">
                    </div>
                    <div class="form-group">
                        <label>Ng√†y sinh:</label>
                        <input type="date" name="birthday" id="edit_birthday">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">H·ªßy</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Contact Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeDeleteModal()">&times;</span>
                <h2>X√°c nh·∫≠n x√≥a</h2>
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a li√™n h·ªá <strong id="delete_contact_name"></strong>?</p>
                <form method="POST" id="deleteForm">
                    {% csrf_token %}
                    <div class="form-actions">
                        <button type="submit" class="btn btn-delete">X√≥a</button>
                        <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">H·ªßy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Modal functions
        function showAddModal() {
            document.getElementById('addModal').style.display = 'block';
        }

        function closeAddModal() {
            document.getElementById('addModal').style.display = 'none';
        }

        function showEditModal(id, firstName, lastName, phone, email, address, birthday) {
            document.getElementById('editModal').style.display = 'block';
            document.getElementById('edit_first_name').value = firstName;
            document.getElementById('edit_last_name').value = lastName;
            document.getElementById('edit_phone_number').value = phone;
            document.getElementById('edit_email').value = email || '';
            document.getElementById('edit_address').value = address || '';
            document.getElementById('edit_birthday').value = birthday !== 'None' ? birthday : '';
            document.getElementById('editForm').action = `/update/${id}/`;
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function showDeleteModal(id, name) {
            document.getElementById('deleteModal').style.display = 'block';
            document.getElementById('delete_contact_name').textContent = name;
            document.getElementById('deleteForm').action = `/delete/${id}/`;
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const addModal = document.getElementById('addModal');
            const editModal = document.getElementById('editModal');
            const deleteModal = document.getElementById('deleteModal');

            if (event.target == addModal) {
                closeAddModal();
            }
            if (event.target == editModal) {
                closeEditModal();
            }
            if (event.target == deleteModal) {
                closeDeleteModal();
            }
        }
    </script>
</body>
</html>